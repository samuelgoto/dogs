<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Dogs</title>
    <script type="application/javascript" src="https://unpkg.com/react@16.3.0/umd/react.production.min.js"></script>
    <script type="application/javascript" src="https://unpkg.com/react-dom@16.3.0/umd/react-dom.production.min.js"></script>
    <script type="application/javascript" src="https://unpkg.com/babel-standalone@6.26.0/babel.js"></script>
    <script src="https://unpkg.com/@material-ui/core/umd/material-ui.development.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">  </head>
  <body style="margin: 0px; background-color: #fafafa;">
    <div id="root"></div>
    <script type="text/babel" data-plugins="transform-decorators-legacy">
      const {
        Button,
        colors,
        createMuiTheme,
        CssBaseline,
        Dialog,
        DialogActions,
        DialogContent,
        DialogContentText,
        DialogTitle,
        Icon,
        MuiThemeProvider,
        Typography,
        withStyles,
        ExpansionPanel,
        ExpansionPanelSummary,
        ExpansionPanelDetails,
        Paper,
        Table,
        TableBody,
        TableCell,
        TableHead,
        TableFooter,
        TablePagination,
        TableRow,
        Tab,
        Tabs,
        Drawer,
        AppBar,
        List,
        ListItem,
        ListItemText,
        Divider,
        Toolbar,
        GridList,
        GridListTile
      } = window['material-ui'];

      // alert(ExpandMore);
      // alert(withStyles);
      // alert(Table);
      const drawerWidth = 240;

      const styles = theme => ({
        root: {
          flexGrow: 1,
          zIndex: 1,
          overflow: 'hidden',
          position: 'relative',
          display: 'flex',
        },
        appBar: {
          zIndex: theme.zIndex.drawer + 1,
          width: `calc(100% - ${drawerWidth}px)`,
          marginLeft: drawerWidth
        },
        drawerPaper: {
          position: 'relative',
          width: drawerWidth,
        },
        content: {
          flexGrow: 1,
          backgroundColor: theme.palette.background.default,
          padding: theme.spacing.unit * 3,
          minWidth: 0, // So the Typography noWrap works
        },
        toolbar: theme.mixins.toolbar,
        heading: {
          fontSize: theme.typography.pxToRem(15),
          flexBasis: "10%",
          flexShrink: 0,
        },
        secondaryHeading: {
          fontSize: theme.typography.pxToRem(15),
          color: theme.palette.text.secondary,
        },
        row: {
          "[selected]": {
            backgroundColor: theme.palette.background.default,
          },
          cursor: "pointer"
        }
      });

      @withStyles(styles)
      class Dataset extends React.Component {
        handleChangePage(event, page) {
          // alert(page);
        };

        render() {
          const {classes} = this.props;
          const dataset = this.props.dataset;
          dataset.classes = dataset.classes || [];

          return (
            <div className={classes.root}>
              <main className={classes.content}>

                <br />
                <Typography className={classes.heading}>{dataset.name}</Typography>
                <br />
                <Typography className={classes.heading}>{dataset.description}</Typography>

                <br />
                <br />

                <Row name="release date" value={dataset.dateReleased} description="hello world" />
                <Row name="creation date" value={dataset.dateCreated} description="hello world" />
                <Row name="published date" value={dataset.datePublished} description="hello world" />
                <Row name="modified date" value={dataset.dateModified} description="hello world" />

                <br />
                <Browser dataset={this.props.dataset} />
              </main>
            </div>
          );
        }
      }

      @withStyles(styles)
      class Browser extends React.Component {
        constructor(props) {
          super();
          this.state = {
            selected: 0
          };

          // alert(props.dataset.classes);
          this.state.classes = (props.dataset.classes || []).map(clazz => {
            if (typeof clazz != "string") {
              return {status: "loaded", value: clazz};
            } else {
              return {status: "loading", value: clazz};
            }
          });

          this.fetch();
        }

        async fetch() {
          let classes = this.state.classes;
          for (let i = 0; i < classes.length; i++) {
            let clazz = classes[i];
            if (clazz.status == "loaded") {
              // passed by value
              continue;
            }
            // console.log(clazz);
            let result = await fetch(clazz.value);
            // console.log(result);
            if (!result.ok) {
              classes[i].status = "failed";
              this.setState({classes: classes});
            } else {
              classes[i].status = "loaded";
              classes[i].value = await result.json();
              this.setState({classes: classes});
            }
          }
        }

        handleClick(e, id) {
          // alert(id);
          this.setState({selected: id});
        }

        render() {
          const {classes} = this.props;
          const list = this.state.classes;

          return (
            <div>
                <Paper>
                  <Table>
                    <TableHead>
                      <TableRow>
                        <TableCell>Class</TableCell>
                        <TableCell>Number of images</TableCell>
                      </TableRow>
                    </TableHead>
                    <TableBody>
                      {
                      list.map((clazz, id) => {
                        return (
                          <TableRow 
                             className={classes.row}
                             onClick={event => this.handleClick(event, id)}>
                            <TableCell>{clazz.status == "loaded" ? clazz.value.name : "loading"}</TableCell>
                            <TableCell>{clazz.status == "loaded" ? (clazz.value.images || []).length : "loading"}</TableCell>
                          </TableRow>
                        )
                      })
                      }
                    </TableBody>
                    <TableFooter>
                      <TableRow>
                        <TablePagination
                           colSpan={2}
                           count={1}
                           rowsPerPage={2}
                           page={0}
                           rowsPerPageOptions={10}
                           onChangePage={this.handleChangePage}
                           />
                      </TableRow>
                    </TableFooter>
                  </Table>
                </Paper>

                <br />
 
                {list[this.state.selected].status == "loaded" && (
                  <div>
                    <Typography className={classes.heading}>{list[this.state.selected].value.name}</Typography>
                    <br />
                    <br />
                    <GridList cellHeight={160} className={classes.gridList} cols={3}>
                      {
                        (list[this.state.selected].value.images || []).map(image => {
                          return (
                            <GridListTile key="hello">
                              <img src={image.url} />
                            </GridListTile>
                          )
                        })
                      }
                    </GridList>
                  </div>
                  )
                }
            </div>
          );
        }
      }

      @withStyles(styles)
      class Row extends React.Component {
        render() {
          const {classes} = this.props;
          return (
             <ExpansionPanel>
               <ExpansionPanelSummary>
                 <Typography className={classes.heading}>{this.props.name}</Typography>
                 <Typography className={classes.secondaryHeading}>{this.props.value}</Typography>
               </ExpansionPanelSummary>
               <ExpansionPanelDetails>
                 <Typography>{this.props.description}</Typography>
               </ExpansionPanelDetails>
             </ExpansionPanel>
          );
        }
      }
            
      let dataset = {
        "@context": "https://code.sgo.to/datasets",
        "@type": "Dataset",
        "url": "http://vision.stanford.edu/aditya86/ImageNetDogs/",
        "author": ["Aditya Khosla", "Nityananda Jayadevaprakash", "Bangpeng Yao", "Li Fei-Fei"],
        "name": "Dog breeds",
        "description": "This is a JSON-LD port of Stanford's ImageNetDogs dataset. It contains 120 dog breeds, ~150 images per class. Total images: 20,580.",
        "citation": [{
          "inproceedings": "KhoslaYaoJayadevaprakashFeiFei_FGVC2011",
          "author": "Aditya Khosla and Nityananda Jayadevaprakash and Bangpeng Yao and Li Fei-Fei",
          "title": "Novel Dataset for Fine-Grained Image Categorization",
          "booktitle": "First Workshop on Fine-Grained Visual Categorization, IEEE Conference on Computer Vision and Pattern Recognition",
          "year": "2011",
          "month": "June",
          "address": "Colorado Springs, CO"
        }, {
          "inproceedings": "imagenet_cvpr09",
          "author": ["Deng", "J. and Dong", "W. and Socher", "R. and Li", "L.-J. and Li", "K. and Fei-Fei, L"],
          "title": "ImageNet: A Large-Scale Hierarchical Image Database",
          "booktitle": "CVPR09",
          "year": "2009",
          "bibsource": "http://www.image-net.org/papers/imagenet_cvpr09.bib"
        }],
        "release": "0.0.1",
        "dateCreated": "2018/10/03",
        "datePublished": "2018/10/03",
        "dateModified": "2018/10/03",
        "classes": [{
            "@type": "Class",
            "name": "Honey",
            "images": [
               "https://material-ui.com/static/images/grid-list/honey.jpg",
               "https://material-ui.com/static/images/grid-list/vegetables.jpg",
               "https://material-ui.com/static/images/grid-list/plant.jpg"
            ]
          }, {
            "@type": "Class",
            "name": "Mushrooms",
            "images": [
               "https://material-ui.com/static/images/grid-list/mushroom.jpg"
            ]
          }
        ]
      };

      function render(dataset, error) {
        // Use the ReactDOM.render to show your component on the browser
        const root = document.getElementById("root")
        ReactDOM.render(<Dataset dataset={dataset} error={error}/>, root);
      }

    </script>

    <script>
      async function load(file) {
        try {
          let result = await fetch(file);
          if (!result.ok) {
            return {error: `Failed to load ${file}. ${result}`};
          }

          return {dataset: await result.json()};
        } catch (e) {
          return {error: `Failed to loading ${file}. Check your JS console.`};
        }
      }

      async function main(file) {
        let {dataset, error} = await load(file);
        render(dataset, error);
      }
      main("index.jsonld");
    </script>

  </body>
</html>
